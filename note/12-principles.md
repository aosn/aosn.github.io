---
layout: subpage
title: 読書ノート - 現場で役立つシステム設計の原則
---

[現場で役立つシステム設計の原則](/workshop/12-principles)の読書ノートです。

## 正誤表

- [サポートページ：現場で役立つシステム設計の原則 〜変更を楽で安全にするオブジェクト指向の実践技法：｜技術評論社](http://gihyo.jp/book/2017/978-4-7741-9087-7/support)

## ノート

### 第1章

* **P24** リーダブルコードにもあるが、数値を定義するときは単位を含めたほうがベター (金額だったら円なのか銭なのかドルなのか)
* **P24** セミコロンの前のスペースとか if の条件式の前後のスペースとか一貫性のないスタイリングがすごい気になる
* **P24** `shippingCost()` に `// 送料を算出する` とコメントが添えられているが、こんなわかりきったコメントいらないのでは (Javadoc ならまだしも)
* **P30** 定数定義の書き方がここと P24 で違う (大文字スネークケース対キャメルケース)
* 値オブジェクト、こんなにオブジェクト作ったらパフォーマンスインパクトありそう
  * ドメイン駆動設計を実践する上では不可欠だが、ボトルネックになるならば分析した上でチューニングしたい
  * サーバーサイドなら札束で殴ればいいけど、組み込みでは限界ある
  * ファーストクラスコレクションのほうはオブジェクト数は +1 するだけなのでパフォーマンスインパクトはほとんどない
  * 値オブジェクトで DB (ORM) 絡むときは DB の型と値オブジェクトの相互変換のためのコンバーターを書く必要があり、ボイラープレート的に変換コードをゴリゴリ実装する必要がある

### 第2章

* **P51** 早期リターン、[リーダブルコード](/note/4-readablecode)を読んだときも同じ議論をしたね
  * Scala ではそもそも非推奨とか。
  * return 1個主義派の主張: Excel でフローチャートが書きやすい :innocent:
* **P53** 網羅性、相互独立性がコードから検査できないのがこのパターンの怖いところ
* **P57** なんでセミコロンがあったりなかったりするのか？誤植？
* **P65** `EnumSet.of` は使ってるのに `EnumMap` は使わないんだ・・・
* **P66** Enum のアプローチも良いけど最近の Better Java 系などの言語だと網羅性検査がある型のパターンマッチで済ませることも
  * Go の type switch は網羅性チェックない・・・
  * Java だと `instanceof` は良くないものという認識があるが、C# とかだと動的型も部分的に持ち込こまれているのでナチュラルにやることがある

### 第3章

* **P68** ORマッパー使ってるとデータクラス量産してしまいやすい
  * ドメインモデル貧血症のことだね
  * Lombok とか使ってナチュラルにデータクラスを量産してしまうシステムをよく見る
* **P73** [GopherCon 2017 の Anti-patterns](https://github.com/gophercon/2017-talks/blob/master/EdwardMuller-GoAntipatterns/GoAntipatterns.pdf) (33スライド目) でも同じ話題あったような
  * StringUtils 的な業務ロジック・ドメインと関係ないものなら util 合ってもいいような気もするけど、いろんなライブラリがこの名前で実装しててなんだかなぁとも思う
  *  util とか common とかあると困ったらここに突っ込んでしまう、肥溜め化する
* **P81** ドメインオブジェクト用のユーティリティメソッド (インスタンス変数はさわらない) は無理に移動せずそのまま static メソッドでぶらさげても良いのでは？
  * Customer 用に Customers クラス作って static メソッドおくとかやらない？
  * この本だと複数形はファーストクラスコレクションに付ける名前って感じ
* **P82** でかすぎる API は使うのもつらいよね
  * RxJava の [Observable](http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html) とか [Flowable](http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html) とか

### 第4章

* **P94** 本当に重複なくなるの!?
  * 継承とか使いまくって重複とか見かけ上消えてもあんまりうれしくないんだよね
  * 日本語の業務ロジック、無理やり英語に直訳したせいでどこに何か書いてあるのかわからなくなったりすることもある。ユビキタス言語的にちゃんと定義するか、あとは日本語のままプログラミングするとかしないとね
* **P107** パッケージ図の依存関係、DI 使うとある程度変えることもできたりするね
* **P121** こういったバリデーション系は C# の Attribute や Java の Annotation 使っていい感じにできるよって ThoughtWorks アンソロジーに書いてあった
* **P123** 「ちょっとした if 文の追加は (中略) まちがった方向です」とあるが、数値の比較とかバリデーションとかの if 文まで NG といっている？過激な主張な気がする
* **P129** `ok` あるんだし `ng` いらないと思う、API が冗長
* **P129** Java 8 の `Optional` 紹介するんなら、コード中の for 文を `Stream#anyMatch` 使うぐらいはやってほしい
* **P137** ようはコミュ力の話だね



